h1 New Job
form(method='post',action='/jobs/new')
  div.ui-widget
    label(for='suburb') Your suburb or town
    input#suburb.flow(placeholder='start typing to see suggestions')
    span#suburb-info.autocomplete-info
    input#suburb-id(type='hidden',name='suburb-id')

script
  $(function() {
    $("#suburb").autocomplete({
      minLength: 2,
      source: function(req, add) {
        $('#suburb-info').text('');
        $.getJSON("/reference/locality", req, function(data) {  
          var suggestions = [];
          if(data.length == 0) {
            $('#suburb-info').text('No matches');
          }
          $.each(data, function(i, val) {  
            if(val.more) {
              $('#suburb-info').text(val.excess + ' more match' + (val.excess > 1 ? 'es' : ''));
            } else {
              suggestions.push({ label: val.label, id: val.id});  
            }
          });  
          add(suggestions);
        });
      },
      select: function(event, ui) {
        if(ui.item) {
          $('#suburb-id').val(ui.item.id);
        }
      }
    }).blur(function() {
      $('#suburb-info').text('');    
    });
  });

